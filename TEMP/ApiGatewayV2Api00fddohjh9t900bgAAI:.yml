ApiGatewayV2Api00fddohjh9t900bgAAI:
    UpdateReplacePolicy: "Retain"
    Type: "AWS::ApiGatewayV2::Api"
    DeletionPolicy: "Retain"
    Properties:
      RouteSelectionExpression: "$request.method $request.path"
      Description: "Created by AWS Lambda"
      CorsConfiguration:
        MaxAge: 0
        AllowOrigins:
        - "https://liamstabeno.com"
        - "https://s3.us-west-2.amazonaws.com"
        AllowCredentials: false
        ExposeHeaders: []
        AllowMethods:
        - "GET"
        - "POST"
        - "OPTIONS"
        AllowHeaders:
        - "content-type"
      ProtocolType: "HTTP"
      DisableExecuteApiEndpoint: false
      Tags: {}
      Name: "VIL-API-1.1"

# -------------------------------------------------------------------------

      AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: Cloud Resume Challege App - Updates DynamoDB table with a count of the total visitors that have visited an index.html page hosted in an S3
Resources:
  LambdaFunction:
    Type: AWS::Serverless::Function
    Properties:
      Description: 'Lambda function updates data in DynamoDB table while retrieving the total amount of visitors'
      Architectures:
      - arm64
      FunctionName: VisitorDataFunction
      CodeUri: /visitor_data
      Handler: app.lambda_handler
      Runtime: python3.12
      Policies:
        - DynamoDBReadPolicy:
            TableName: !Ref DynamoDBTable
        - DynamoDBWritePolicy:
            TableName: !Ref DynamoDBTable
      Events:
        HttpApiGetEvent:
          Type: HttpApi
          Properties:
            Path: /
            Method: GET
            ApiId: !Ref VisitorDataHttpApi
        HttpApiPostEvent:
          Type: HttpApi
          Properties:
            Path: /
            Method: POST
            ApiId: !Ref VisitorDataHttpApi
  VisitorDataHttpApi:
    Type: AWS::Serverless::HttpApi
    Properties:
      CorsConfiguration:
        AllowHeaders:
        - 'content-type'
        AllowMethods:
        - GET
        - POST
        - OPTIONS
        AllowOrigins:
        - '*'
  DynamoDBTable:
    Type: AWS::Serverless::SimpleTable
    Properties:
      TableName: PageVisits
      PrimaryKey:
        Name: PageId
        Type: String
